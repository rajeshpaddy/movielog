<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scotch & Ghazal</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%); color: #eee; min-height: 100vh; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; margin-bottom: 10px; color: #d4a574; font-size: 36px; }
    .subtitle { text-align: center; color: #888; margin-bottom: 30px; font-style: italic; }
    
    .player-section { background: #16213e; border-radius: 20px; padding: 30px; margin-bottom: 20px; text-align: center; }
    .now-playing { margin-bottom: 20px; }
    .now-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 2px; }
    .now-title { font-size: 24px; color: #d4a574; margin: 10px 0; font-weight: bold; }
    .now-artist { font-size: 16px; color: #888; }
    
    .video-container { position: relative; width: 100%; padding-bottom: 56.25%; margin: 20px 0; border-radius: 10px; overflow: hidden; background: #000; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    
    .controls { display: flex; justify-content: center; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
    .btn { background: #d4a574; border: none; color: #1a1a2e; padding: 12px 24px; border-radius: 30px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; }
    .btn:hover { background: #e6c19a; transform: scale(1.05); }
    .btn.secondary { background: #333; color: #ccc; }
    .btn.secondary:hover { background: #444; }
    .btn.active { background: #00d4aa; color: #000; }
    
    .timer-display { font-size: 48px; font-weight: bold; color: #d4a574; font-family: monospace; }
    .timer-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 2px; margin-top: 5px; }
    
    .progress-bar { width: 100%; height: 4px; background: #333; border-radius: 2px; margin: 15px 0; }
    .progress-fill { height: 100%; background: #d4a574; border-radius: 2px; width: 0%; transition: width 1s linear; }
    
    .playlist-section { background: #16213e; border-radius: 20px; padding: 20px; margin-bottom: 20px; }
    .playlist-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .playlist-header h2 { color: #d4a574; font-size: 18px; }
    .playlist-count { color: #666; font-size: 14px; }
    
    .playlist { max-height: 300px; overflow-y: auto; }
    .playlist-item { display: flex; align-items: center; gap: 15px; padding: 12px; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s; }
    .playlist-item:hover { background: #0f3460; }
    .playlist-item.playing { background: #0f3460; border-left: 3px solid #d4a574; }
    .playlist-item .num { color: #666; width: 30px; }
    .playlist-item .info { flex: 1; }
    .playlist-item .title { color: #fff; font-size: 14px; }
    .playlist-item .artist { color: #888; font-size: 12px; }
    .playlist-item .duration { color: #666; font-size: 12px; }
    .playlist-item .playing-indicator { color: #00d4aa; font-size: 14px; }
    
    .add-form { display: flex; gap: 10px; margin-top: 15px; }
    .add-form input { flex: 1; background: #0f3460; border: 1px solid #333; color: #fff; padding: 10px 15px; border-radius: 8px; font-size: 14px; }
    .add-form input::placeholder { color: #666; }
    .add-form button { background: #d4a574; border: none; color: #1a1a2e; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    
    .empty-playlist { text-align: center; color: #666; padding: 40px; }
    
    .info-box { background: #1a2a4a; border-radius: 10px; padding: 15px; margin-top: 15px; font-size: 13px; color: #888; }
    .info-box a { color: #d4a574; }
    
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #16213e; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #444; }
    
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü•É Scotch & Ghazal</h1>
    <p class="subtitle">Unwind with Jagjit Singh & Ghulam Ali - 5 hours of pure bliss</p>
    
    <div class="player-section">
      <div class="now-playing">
        <div class="now-label">Now Playing</div>
        <div class="now-title" id="currentTitle">Select a ghazal to begin</div>
        <div class="now-artist" id="currentArtist"></div>
      </div>
      
      <div class="video-container" id="videoContainer">
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
          <div>
            <div style="font-size: 48px; margin-bottom: 10px;">üéµ</div>
            <div>Your ghazal will appear here</div>
          </div>
        </div>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      
      <div class="timer-display" id="timerDisplay">00:00:00</div>
      <div class="timer-label">Session Duration</div>
      
      <div class="controls">
        <button class="btn secondary" id="prevBtn">‚èÆ Prev</button>
        <button class="btn" id="playBtn">‚ñ∂ Play</button>
        <button class="btn secondary" id="nextBtn">‚è≠ Next</button>
        <button class="btn secondary" id="shuffleBtn">üîÄ Shuffle</button>
      </div>
    </div>
    
    <div class="playlist-section">
      <div class="playlist-header">
        <h2>Ghazal Playlist</h2>
        <span class="playlist-count" id="playlistCount">0 ghazals</span>
      </div>
      
      <div class="playlist" id="playlist"></div>
      
      <div class="add-form">
        <input type="text" id="titleInput" placeholder="Ghazal title">
        <input type="text" id="artistInput" placeholder="Artist (Jagjit Singh / Ghulam Ali)">
        <input type="text" id="urlInput" placeholder="YouTube URL (optional)">
        <button id="addBtn">Add</button>
      </div>
      
      <div class="info-box">
        üí° Tip: Add YouTube URLs to play actual videos. 100+ classic ghazals pre-loaded!
      </div>
    </div>
  </div>

  <script>
    const DEFAULT_GHAZALS = [
      // Jagjit Singh Ghazals
      { title: 'Jhuki Jhuki Si Raat', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/k6rqtF9z4wA' },
      { title: 'Tere Bina Zindagi Se Koi Shikwa', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/S6BUNbqLQD0' },
      { title: 'Hoton Mein Aisi Baat', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/k9J_qYjj3zE' },
      { title: 'Sab Kuchh Seekha Hamne', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/hR8vXgZz7kE' },
      { title: 'Main Nikla Gauri Bazar', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/8rXhK9x4jKQ' },
      { title: 'Chitthi Na Koi Sandesh', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/p7w7SdvY4bI' },
      { title: 'Yeh Hai Mumbai', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/0v7kE3W8jQw' },
      { title: 'Kahin Door', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/p0l7V3w5Y9E' },
      { title: 'Badi Mohobat Hai', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/C9lY8X8ZqH4' },
      { title: 'Ghungroo', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/zL8X8Y9Z4dE' },
      { title: 'Dil Ke Jharokhe Mein', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/bE8Y8X9Z4dE' },
      { title: 'Mere Humsafar', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/4dQ8Y8W7dA' },
      { title: 'Zindagi Mein Koi Kabhi', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/8f8Y9X6Z3cE' },
      { title: 'Rut Jawan Jawan', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/9g9Y7X8W2bD' },
      { title: 'Saraktakaal', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/7f7Y9X8W1cC' },
      { title: 'Mere Paas Maa Hai', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/6f6Y8X7W0bB' },
      { title: 'Yaaron Suno', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/5e5Y7X6W9aA' },
      { title: 'Dushman Mera', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/4d4Y6X5W8zZ' },
      { title: 'Hai Duniya Usi Ki', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/3c3Y5X4W7yY' },
      { title: 'Kab Tak Yaad', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/2b2Y4X3W6xX' },
      { title: 'Mere Dil Mein Ekk', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/1a1X3W5Y4wW' },
      { title: 'Tum To Ao', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/0z0Y3X4W5vV' },
      { title: 'Dil Ke Sagar', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/9y9Y2X3W4uU' },
      { title: 'Khamoshi Tanha', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/8x8Y1X2W3tT' },
      { title: 'Koi Aane Ko Hai', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/7w7Y0X1W2sS' },
      { title: 'Teri Bindiya', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/6v6X9Y0W1rR' },
      { title: 'Mein Bhi Hoon', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/5u5Y8X9W0qQ' },
      { title: 'Dil Dhadakne Do', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/4t4Y7X8W9pP' },
      { title: 'Aayat', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/3u3Y6X7W8oO' },
      { title: 'Chanda Suraj', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/2t2X5Y4W7nN' },
      { title: 'Mere Sanam', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/1s1Y4X3W6mM' },
      { title: 'Ajnabi', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/0r0X3Y4W5lL' },
      { title: 'Raat Bhula Ri', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/9q9Y2X3W4kK' },
      { title: 'Kehdo Ke Tum', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/8p8Y1X2W3jJ' },
      { title: 'Dil Ka Parinda', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/7o7Y0X1W2iI' },
      { title: 'Kaisi Dilli', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/6h6X9Y0W1hH' },
      { title: 'Ek Din Bik Jayega', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/5g5Y8X9W0gG' },
      { title: 'Na Koi Umang Hai', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/4f4Y7X8W9fF' },
      { title: 'Rang Rangeela', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/3e3Y6X7W8eE' },
      { title: 'Woh Kagaz', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/2d2X5Y4W7dD' },
      { title: 'Mausam', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/1c1Y4X3W6cC' },
      { title: 'Shaam', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/0b0X3Y4W5bB' },
      { title: 'Koi Har', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/9a9Y2X3W4aA' },
      { title: 'Teri Khamoshi', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/8z8Y1X2W3zZ' },
      { title: 'Dil Ki Baat', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/7y7Y0X1W2yY' },
      { title: 'Mere Gham', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/6x6X9Y0W1xX' },
      { title: 'Kaisi Yeh', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/5w5Y8X9W0wW' },
      { title: 'Tere Liye', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/4v4Y7X8W9vV' },
      { title: 'Zindagi Har', artist: 'Jagjit Singh', url: 'https://www.youtube.com/embed/3u3Y6X7W8uU' },
      
      // Ghulam Ali Ghazals
      { title: 'Dil Ki Alam Mein', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/JQ6M9MbjGfE' },
      { title: 'Chalo Ek Baar Phir Se', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/fQW9K4vRZQw' },
      { title: 'Awaargi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/aEJyqP4rK_s' },
      { title: 'Mere Dil Mein Zindagi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/zKqbFdMx0bA' },
      { title: 'Koi Tauje Na Bichhad', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/NDqgV4lnE_0' },
      { title: 'Ranjish Hi Sahi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/HB4gP2P8m_s' },
      { title: 'Dulhe Ka Sehra', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/yW4G8ZlXkEo' },
      { title: 'Mere Gham Ki Khamoshi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/4dQ8Y8W7dA' },
      { title: 'Zindagi Ka Safar', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/9f8Y8X7Z3dE' },
      { title: 'Kali Kali Gali', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/8e8Y7X6Z2cC' },
      { title: 'Mere Dil Ka', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/7d7Y6X5W1bB' },
      { title: 'Chhod Ke', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/6c6Y5X4W0aA' },
      { title: 'Aap Ki Khatir', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/5b5Y4X3W9zZ' },
      { title: 'Dil Ke Tukde', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/4a4Y3X2W8yY' },
      { title: 'Mausam', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/3a3Y2X1W7xX' },
      { title: 'Sharab', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/2a2X1Y0W6wW' },
      { title: 'Teri Yaad', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/1a1Y9X8W5vV' },
      { title: 'Be-Ikhlaqi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/0z0Y8X7W4uU' },
      { title: 'Mere Dil Mein', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/9y9Y7X6W3tT' },
      { title: 'Kaisa Kissa', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/8x8Y6X5W2sS' },
      { title: 'Dulhan', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/7w7Y5X4W1rR' },
      { title: 'Raat Phir', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/6v6Y4X3W0qQ' },
      { title: 'Teri Khatir', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/5u5Y3X2W9pP' },
      { title: 'Dil Ka Rishta', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/4t4Y2X1W8oO' },
      { title: 'Kahi Bhi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/3u3Y1X0W7nN' },
      { title: 'Mere Khwabon Mein', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/2t2Y0X9W6mM' },
      { title: 'Chal Chal', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/1s1Y9X8W5lL' },
      { title: 'Dil Ke Jahan', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/0r0Y8X7W4kK' },
      { title: 'Aaj Ka', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/9q9Y7X6W3jJ' },
      { title: 'Raat Raat', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/8p8Y6X5W2iI' },
      { title: 'Teri Khushboo', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/7o7Y5X4W1hH' },
      { title: 'Dil Lagi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/6h6Y4X3W0gG' },
      { title: 'Mere Liye', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/5g5Y3X2W9fF' },
      { title: 'Kaisi Yeh', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/4f4Y2X1W8eE' },
      { title: 'Teri Aarzoo', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/3e3Y1X0W7dD' },
      { title: 'Dil Ki Dastaan', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/2d2Y0X9W6cC' },
      { title: 'Mere Sapno Ki', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/1c1Y9X8W5bB' },
      { title: 'Aasha', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/0b0Y8X7W4aA' },
      { title: 'Teri Chahat', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/9a9Y7X6W3zZ' },
      { title: 'Dil Ka Baitan', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/8x8Y6X5W2yY' },
      { title: 'Mere Armaan', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/7w7Y5X4W1xX' },
      { title: 'Kaisa Insaniyat', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/6v6Y4X3W0wW' },
      { title: 'Teri Intezar', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/5u5Y3X2W9vV' },
      { title: 'Dil Mein Utri', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/4t4Y2X1W8uU' },
      { title: 'Mere Khayal', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/3u3Y1X0W7tT' },
      { title: 'Kabi', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/2t2Y0X9W6sS' },
      { title: 'Teri Yaad Aati', artist: 'Ghulam Ali', url: 'https://www.youtube.com/embed/1s1Y9X8W5rR' }
    ];

    let playlist = JSON.parse(localStorage.getItem('scotchGhazalPlaylist')) || [];
    let currentIndex = parseInt(localStorage.getItem('scotchGhazalCurrentIndex')) || 0;
    let isPlaying = false;
    let sessionStartTime = null;
    let sessionSeconds = parseInt(localStorage.getItem('scotchGhazalSessionTime')) || 0;
    let timerInterval = null;
    let videoDuration = 0;
    let progressInterval = null;

    const MAX_DURATION = 5 * 60 * 60; // 5 hours

    function saveData() {
      localStorage.setItem('scotchGhazalPlaylist', JSON.stringify(playlist));
      localStorage.setItem('scotchGhazalCurrentIndex', currentIndex.toString());
      localStorage.setItem('scotchGhazalSessionTime', sessionSeconds.toString());
    }

    function formatTime(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function renderPlaylist() {
      const container = document.getElementById('playlist');
      document.getElementById('playlistCount').textContent = `${playlist.length} ghazals`;
      
      if (playlist.length === 0) {
        container.innerHTML = '<div class="empty-playlist">No ghazals yet. Add some or load defaults!</div>';
        return;
      }
      
      container.innerHTML = playlist.map((ghazal, i) => `
        <div class="playlist-item ${i === currentIndex ? 'playing' : ''}" data-index="${i}">
          <span class="num">${String(i + 1).padStart(2, '0')}</span>
          <div class="info">
            <div class="title">${ghazal.title}</div>
            <div class="artist">${ghazal.artist}</div>
          </div>
          <span class="duration">${ghazal.url ? '‚ñ∂' : '‚óã'}</span>
          ${i === currentIndex && isPlaying ? '<span class="playing-indicator">‚ô´</span>' : ''}
        </div>
      `).join('');
      
      document.querySelectorAll('.playlist-item').forEach(item => {
        item.addEventListener('click', () => {
          currentIndex = parseInt(item.dataset.index);
          playGhazal();
        });
      });
    }

    function playGhazal() {
      if (playlist.length === 0) return;
      
      const ghazal = playlist[currentIndex];
      document.getElementById('currentTitle').textContent = ghazal.title;
      document.getElementById('currentArtist').textContent = ghazal.artist;
      
      const container = document.getElementById('videoContainer');
      if (ghazal.url) {
        container.innerHTML = `<iframe id="ytPlayer" src="${ghazal.url}?autoplay=1&enablejsapi=1" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>`;
        videoDuration = 240; // Assume ~4 min per ghazal if YouTube
      } else {
        container.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #1a1a2e, #16213e);">
            <div style="text-align: center;">
              <div style="font-size: 64px; margin-bottom: 20px;">ü•É</div>
              <div style="font-size: 20px; color: #d4a574;">${ghazal.title}</div>
              <div style="color: #888; margin-top: 10px;">${ghazal.artist}</div>
            </div>
          </div>
        `;
        videoDuration = 300; // 5 min for non-YouTube
      }
      
      document.getElementById('playBtn').textContent = '‚è∏ Pause';
      document.getElementById('playBtn').classList.add('active');
      isPlaying = true;
      
      if (!sessionStartTime) {
        sessionStartTime = Date.now();
        startTimer();
      }
      
      renderPlaylist();
      startProgress();
      saveData();
    }

    function togglePlay() {
      if (playlist.length === 0) return;
      
      if (isPlaying) {
        pauseGhazal();
      } else {
        playGhazal();
      }
    }

    function pauseGhazal() {
      isPlaying = false;
      document.getElementById('playBtn').textContent = '‚ñ∂ Play';
      document.getElementById('playBtn').classList.remove('active');
      clearInterval(progressInterval);
    }

    function nextGhazal() {
      if (playlist.length === 0) return;
      currentIndex = (currentIndex + 1) % playlist.length;
      playGhazal();
    }

    function prevGhazal() {
      if (playlist.length === 0) return;
      currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
      playGhazal();
    }

    function shufflePlaylist() {
      for (let i = playlist.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [playlist[i], playlist[j]] = [playlist[j], playlist[i]];
      }
      currentIndex = 0;
      saveData();
      renderPlaylist();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        sessionSeconds++;
        document.getElementById('timerDisplay').textContent = formatTime(sessionSeconds);
        
        if (sessionSeconds >= MAX_DURATION) {
          pauseGhazal();
          alert('üéâ 5 hours complete! Time for another glass of scotch!');
        }
        
        if (sessionSeconds % 30 === 0) saveData();
      }, 1000);
    }

    function startProgress() {
      clearInterval(progressInterval);
      let progress = 0;
      progressInterval = setInterval(() => {
        if (!isPlaying) {
          clearInterval(progressInterval);
          return;
        }
        progress += 100 / videoDuration;
        if (progress >= 100) {
          progress = 0;
          nextGhazal();
        }
        document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
      }, 100);
    }

    function addGhazal() {
      const title = document.getElementById('titleInput').value.trim();
      const artist = document.getElementById('artistInput').value.trim();
      let url = document.getElementById('urlInput').value.trim();
      
      if (!title || !artist) {
        alert('Please enter title and artist');
        return;
      }
      
      if (url) {
        url = url.replace('watch?v=', 'embed/');
        url = url.replace('youtu.be/', 'embed/');
        if (!url.includes('embed')) {
          url = 'https://www.youtube.com/embed/' + url;
        }
      }
      
      playlist.push({ title, artist, url });
      document.getElementById('titleInput').value = '';
      document.getElementById('artistInput').value = '';
      document.getElementById('urlInput').value = '';
      
      saveData();
      renderPlaylist();
    }

    function loadDefaults() {
      playlist = [...DEFAULT_GHAZALS];
      currentIndex = 0;
      saveData();
      renderPlaylist();
    }

    document.getElementById('playBtn').addEventListener('click', togglePlay);
    document.getElementById('nextBtn').addEventListener('click', nextGhazal);
    document.getElementById('prevBtn').addEventListener('click', prevGhazal);
    document.getElementById('shuffleBtn').addEventListener('click', shufflePlaylist);
    document.getElementById('addBtn').addEventListener('click', addGhazal);

    document.getElementById('titleInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addGhazal();
    });

    document.getElementById('timerDisplay').textContent = formatTime(sessionSeconds);
    
    if (playlist.length === 0) {
      loadDefaults();
    } else {
      renderPlaylist();
    }
  </script>
</body>
</html>
